<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Secret Santa üéÅ</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.09);
      --text:#e8eefc;
      --muted:rgba(232,238,252,.72);
      --accent:#7c5cff;
      --ok:#23c483;
      --danger:#ff4d6d;
      --border:rgba(255,255,255,.12);
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      --sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 800px at 30% 10%, rgba(124,92,255,.25), transparent 55%),
        radial-gradient(900px 700px at 80% 35%, rgba(35,196,131,.18), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 60px;}
    header{display:flex;gap:14px;align-items:flex-start;justify-content:space-between;margin-bottom:18px;}
    h1{margin:0;font-size:28px;letter-spacing:.2px}
    .sub{margin-top:6px;color:var(--muted);line-height:1.4}
    .badge{
      font-size:12px;color:var(--muted);
      border:1px solid var(--border);
      padding:8px 10px;border-radius:999px;
      background:rgba(255,255,255,.03);
      white-space:nowrap;height:fit-content;
    }
    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:16px;}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 16px;
      background:rgba(255,255,255,.03);
      border-bottom:1px solid var(--border);
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .card .bd{padding:16px;}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:8px;}
    input[type="password"], input[type="text"], select{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.18);
      color:var(--text);
      outline:none;
    }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media (max-width:560px){.row{grid-template-columns:1fr}}
    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px;}
    button{
      appearance:none;border:none;
      padding:11px 14px;border-radius:12px;
      cursor:pointer;font-weight:650;
      background:var(--card2);color:var(--text);
      border:1px solid var(--border);
      transition:transform .06s ease, opacity .2s ease, background .2s ease;
      user-select:none;
    }
    button:active{transform:translateY(1px)}
    .primary{background:rgba(124,92,255,.25);border-color:rgba(124,92,255,.55);}
    .ok{background:rgba(35,196,131,.18);border-color:rgba(35,196,131,.55);}
    .danger{background:rgba(255,77,109,.16);border-color:rgba(255,77,109,.55);}
    .muted{opacity:.88;font-weight:600;}
    .status{
      margin-top:10px;padding:10px 12px;border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      color:var(--muted);font-size:13px;line-height:1.45;
    }
    .status strong{color:var(--text)}
    .hidden{display:none!important;}
    .revealBox{
      margin-top:14px;border-radius:14px;
      border:1px dashed rgba(255,255,255,.22);
      padding:14px;background:rgba(0,0,0,.14);
    }
    .big{font-size:18px;margin:0;font-weight:800;letter-spacing:.2px}
    .gift{margin-top:8px;font-size:14px;color:var(--muted);line-height:1.45}
    .kbd{
      font-family:var(--mono);
      font-size:12px;padding:2px 8px;border:1px solid var(--border);
      border-radius:999px;background:rgba(255,255,255,.04);color:var(--muted);
    }
    footer{margin-top:14px;color:rgba(232,238,252,.55);font-size:12px;line-height:1.4}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Secret Santa üéÅ</h1>
        <div class="sub">
          Login pakai <span class="kbd">Nama</span> + <span class="kbd">Password</span>,
          lalu <span class="kbd">Hold to Reveal</span>.
        </div>
      </div>
      <div class="badge">Pairing fixed (encrypted) ‚úÖ</div>
    </header>

    <!-- LOGIN -->
    <section class="card" id="loginCard">
      <div class="hd">
        <strong>Login</strong>
        <span class="kbd">12 members</span>
      </div>
      <div class="bd">
        <div class="row">
          <div>
            <label for="nameSel">Nama</label>
            <select id="nameSel">
              <option value="">‚Äî pilih namamu ‚Äî</option>
            </select>
          </div>
          <div>
            <label for="pw">Password</label>
            <input id="pw" type="password" placeholder="contoh: Namamu##" autocomplete="off" />
            <div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
              <button class="muted" id="showPwBtn" type="button">Show</button>
              <span class="kbd">jangan pakai password asli ya</span>
            </div>
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="loginBtn" type="button">Login</button>
        </div>

        <div class="status" id="loginStatus">
          Pilih nama, masukkan password, lalu login. Setelah itu, kamu bisa reveal hadiahmu.
        </div>

        <footer>
          Catatan: Ini bukan sistem keamanan serius (for fun). Kalau mau lebih aman, pakai repo private (kalau plan GitHub kamu mendukung Pages untuk private).
        </footer>
      </div>
    </section>

    <!-- REVEAL -->
    <section class="card hidden" id="revealCard">
      <div class="hd">
        <strong>Reveal</strong>
        <span class="kbd" id="whoBadge">‚Äî</span>
      </div>
      <div class="bd">
        <div class="btns">
          <button class="ok" id="holdBtn" type="button">Hold to Reveal</button>
          <button id="toggleBtn" type="button">Toggle Reveal</button>
          <button class="danger" id="logoutBtn" type="button">Logout</button>
        </div>

        <div class="revealBox hidden" id="revealBox" aria-live="polite">
          <p class="big" id="revealTitle">üéÅ Kamu dapat: ‚Ä¶</p>
          <div class="gift" id="revealHint">
            Lepas tombol untuk menyembunyikan lagi. (Biar yang lain nggak ngintip.)
          </div>
        </div>

        <div class="status" id="revealStatus">
          Tips: yang lain jangan lihat layar. Kamu bisa tahan tombol reveal sebentar aja terus lepas.
        </div>
      </div>
    </section>
  </div>

  <script>
    // ==========================================================
    // Users + pairing are FIXED and stored ENCRYPTED per user.
    // No plaintext "who gets who" appears in the code.
    // ==========================================================

    const USERS = [
      {"name":"Baskoro","salt":"xEz1Y1bxXsRYzohqmaX2rA==","iter":120000,"verifier":"D9Fjs+8x0YsQhQQqDZSFplNzga/TQXT63Tn+hW7p5AI=","iv":"ArBZKG6DPGdVLbYm","ct":"S1blfBSfwb8aHj+hNoQgmKEdAQ=="},
      {"name":"Talitha","salt":"jMZQ2TudW3Wmftolnn7kIg==","iter":120000,"verifier":"8hyNrzxx2sarmyhd/xQ5rjVkOfBPXRvgrqlNY4n8R5I=","iv":"VCL5AbzWgYZ6uDUv","ct":"5HYh9cQkBgNqU51R/YST8NwyjQ=="},
      {"name":"Afi","salt":"dZ3Tdu5ebqC/ivtuu7EwXA==","iter":120000,"verifier":"ykhZDgvS+TcEWCbTHsvnKgqITstMHoy4ydoHfx4n89c=","iv":"csO2de6Ugmm3amYy","ct":"xjZsbfx/jOXHwL5Pzkas44dmHA=="},
      {"name":"Ami","salt":"5gcYBtEpLhBsZjKTJYqkrg==","iter":120000,"verifier":"b2TGknkYzPGXRq2IX/NqiXlYqH46cd2NbmkhIdKBdY0=","iv":"iFtkyOBBoJsoEYRb","ct":"L74HEZ1oFOTYULV+KY3p3eTwnanC8ow="},
      {"name":"Agung","salt":"gS+OLOnHT1mTmQM/SNVE4A==","iter":120000,"verifier":"mprwxEFcwJFWRo3/+1UB2l3e0SL5q1vA8eXAaYnS7Fg=","iv":"DNF7DtGNgg5tXigx","ct":"QOnEqgmlj9TP52oYQPKPqWZjXTk="},
      {"name":"Sae","salt":"GitR+icqB81Qu7aKm0TeoA==","iter":120000,"verifier":"7lOglfD51PbjQEGyebBjoSuz6BsHVrS5TmnjNbwy4uA=","iv":"6lTmUhoIaUf73Tzu","ct":"YBmQyfuPPSQWHkLvrdfcme7JJr4="},
      {"name":"Icha","salt":"zmVx0IBI1SrJIXE0U4ZOhg==","iter":120000,"verifier":"LVMBDEJHfeCuAyUNxLnoSlqPB9CETC+CQwx6+mRzVT0=","iv":"QmD3H0zHg7mHq3Q2","ct":"LDQ3862O1XwbDEtpyMW+sfhTElHv"},
      {"name":"Lili","salt":"w9G675xCKjUH6L2Bcig/Sg==","iter":120000,"verifier":"McpQG1viy7amPsfIoiL8/pgUVixERDf8N4m6c8rRLHo=","iv":"YOWWi6q5OygeSrgC","ct":"1og9tUgDEV3O44GFPYqkCLDc/N41"},
      {"name":"Zhafa","salt":"icvucw1CfuOq4WNnb0aDMA==","iter":120000,"verifier":"bC23c5N9gL82Zfs5f/3248VomdcZaVwHeoqfTBkp0xc=","iv":"kHy9DB1FXnF+elQZ","ct":"HwOMAclFRVuVj0cFifcFNTHTq4bE"},
      {"name":"Zakky","salt":"0abK8LGef8Rh4HBtOkADJA==","iter":120000,"verifier":"zdYo1Yjw7NPsEjVYMWP5lLcPPTAJxbSd4p80cqxJrjU=","iv":"ynb1fsLE5Pen01uN","ct":"gqwmpToBtYiGBPK1cgp+NWGs0F0="},
      {"name":"Gladhys","salt":"LK7jeUhgWHh+A3PnhvSFvQ==","iter":120000,"verifier":"/0ogEGRD7+g6NfV8iVA26JpLinByZFuyRgm0jSFjwyQ=","iv":"T2jif+BAcj+gZIr/","ct":"FPL5Gfep3DgQRF+lbfY31PcCQndhE/A="},
      {"name":"Rani","salt":"SpNqSXAtc3WGEMdmplrqYg==","iter":120000,"verifier":"e1NiKtjGk7OiIfDNrxAqg/G6W9i1JQnDkpws+te0KMU=","iv":"9viTu96FrYd4dufZ","ct":"+OXFtznLfG2GgMSfkRY9HSDxAApUrVI="}
    ];

    // ---------- helpers ----------
    const $ = (id) => document.getElementById(id);
    const enc = new TextEncoder();
    const dec = new TextDecoder();

    function b64ToBytes(b64){
      const bin = atob(b64);
      const out = new Uint8Array(bin.length);
      for (let i = 0; i < bin.length; i++) out[i] = bin.charCodeAt(i);
      return out;
    }
    function bytesToB64(bytes){
      let bin = "";
      for (let i = 0; i < bytes.length; i++) bin += String.fromCharCode(bytes[i]);
      return btoa(bin);
    }
    function setLoginStatus(html, kind="info"){
      const box = $("loginStatus");
      box.innerHTML = html;
      box.style.borderColor =
        kind === "ok" ? "rgba(35,196,131,.55)" :
        kind === "bad" ? "rgba(255,77,109,.55)" :
        "rgba(255,255,255,.12)";
    }
    function setRevealStatus(html, kind="info"){
      const box = $("revealStatus");
      box.innerHTML = html;
      box.style.borderColor =
        kind === "ok" ? "rgba(35,196,131,.55)" :
        kind === "bad" ? "rgba(255,77,109,.55)" :
        "rgba(255,255,255,.12)";
    }

    // ---------- fill name dropdown ----------
    const nameSel = $("nameSel");
    USERS.map(u => u.name).sort((a,b)=>a.localeCompare(b,"id")).forEach(n=>{
      const o=document.createElement("option");
      o.value=n; o.textContent=n;
      nameSel.appendChild(o);
    });

    // ---------- session state ----------
    let current = null; // { name, recipient }
    let revealed = false;

    async function verifyAndDecrypt(name, password){
      const user = USERS.find(u => u.name === name);
      if (!user) throw new Error("Nama tidak ditemukan.");

      const salt = b64ToBytes(user.salt);
      const pwBytes = enc.encode(password);

      // verifier = SHA-256(salt || password)
      const combo = new Uint8Array(salt.length + pwBytes.length);
      combo.set(salt, 0);
      combo.set(pwBytes, salt.length);
      const hashBuf = await crypto.subtle.digest("SHA-256", combo);
      const hashB64 = bytesToB64(new Uint8Array(hashBuf));

      if (hashB64 !== user.verifier){
        throw new Error("Password salah.");
      }

      // derive AES-GCM key with PBKDF2
      const baseKey = await crypto.subtle.importKey(
        "raw",
        pwBytes,
        { name: "PBKDF2" },
        false,
        ["deriveKey"]
      );

      const aesKey = await crypto.subtle.deriveKey(
        { name: "PBKDF2", salt, iterations: user.iter, hash: "SHA-256" },
        baseKey,
        { name: "AES-GCM", length: 256 },
        false,
        ["decrypt"]
      );

      const iv = b64ToBytes(user.iv);
      const ct = b64ToBytes(user.ct);

      const ptBuf = await crypto.subtle.decrypt(
        { name: "AES-GCM", iv },
        aesKey,
        ct
      );

      return dec.decode(ptBuf); // recipient name (plaintext) ‚Äî not stored in code
    }

    function showReveal(show){
      if (!current) return;
      if (show){
        $("revealTitle").textContent = `üéÅ Kamu dapat: ${current.recipient}`;
        $("revealBox").classList.remove("hidden");
      } else {
        $("revealBox").classList.add("hidden");
      }
      revealed = show;
    }

    function enterReveal(){
      $("loginCard").classList.add("hidden");
      $("revealCard").classList.remove("hidden");
      $("whoBadge").textContent = current?.name ? `Logged in: ${current.name}` : "‚Äî";
      showReveal(false);
      setRevealStatus("Tekan & tahan <strong>Hold to Reveal</strong> untuk melihat, lalu lepas untuk menyembunyikan lagi.", "ok");
    }

    function logout(){
      current = null;
      revealed = false;
      $("pw").value = "";
      nameSel.value = "";
      $("revealCard").classList.add("hidden");
      $("loginCard").classList.remove("hidden");
      $("revealBox").classList.add("hidden");
      setLoginStatus("Logout berhasil. Pilih nama lagi untuk login.", "ok");
    }

    // ---------- login handler ----------
    $("loginBtn").addEventListener("click", async () => {
      const name = nameSel.value.trim();
      const pw = $("pw").value;

      if (!name){
        setLoginStatus("Pilih <strong>Nama</strong> dulu ya.", "bad");
        return;
      }
      if (!pw){
        setLoginStatus("Masukkan <strong>Password</strong> dulu ya.", "bad");
        return;
      }

      setLoginStatus("Memverifikasi‚Ä¶", "info");

      try{
        // decrypt only for this user
        const recipient = await verifyAndDecrypt(name, pw);
        current = { name, recipient };
        setLoginStatus(`Login sukses ‚úÖ <span class="kbd">${name}</span>`, "ok");
        $("pw").value = "";
        enterReveal();
      } catch (e){
        setLoginStatus(`Gagal login ‚ùå ${e.message}`, "bad");
      }
    });

    // show/hide password
    $("showPwBtn").addEventListener("click", () => {
      const el = $("pw");
      el.type = (el.type === "password") ? "text" : "password";
      $("showPwBtn").textContent = (el.type === "password") ? "Show" : "Hide";
    });

    // ---------- hold-to-reveal ----------
    const holdBtn = $("holdBtn");
    const startHold = (e) => { e.preventDefault(); showReveal(true); };
    const endHold   = (e) => { e.preventDefault(); showReveal(false); };

    holdBtn.addEventListener("mousedown", startHold);
    holdBtn.addEventListener("mouseup", endHold);
    holdBtn.addEventListener("mouseleave", endHold);

    holdBtn.addEventListener("touchstart", startHold, {passive:false});
    holdBtn.addEventListener("touchend", endHold, {passive:false});
    holdBtn.addEventListener("touchcancel", endHold, {passive:false});

    // toggle reveal
    $("toggleBtn").addEventListener("click", () => {
      showReveal(!revealed);
    });

    // logout
    $("logoutBtn").addEventListener("click", logout);

    // initial hint
    if (!window.crypto?.subtle){
      setLoginStatus("Browser kamu tidak mendukung WebCrypto. Coba pakai browser modern (Chrome/Safari terbaru).", "bad");
    }
  </script>
</body>
</html>
